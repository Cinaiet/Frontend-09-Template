学习笔记

## Js文法
文法是编译原理中对语言写法的一种规定。一般来说可分为词法和语法两类。

### 词法

词法定义了语言的最小单元: **token**。

#### Js源码分类
1. WhiteSpace 空白字符 如 <HT> <VT> <NBSP>
2. LineTerminator 换行符 如<LF><CR><LS><PS>
3. Comment 注释 如 // /***/
4. Token 词
    -  IdentifierName 标识符名称。如变量名
    - Punctuator 符号。如运算符和大括号
    - NumericLiteral 数字直接量。 如数字
    - StringLiteral 字符串直接量。如双引号或单引号引起来的直接量
    - Template 字符串模板。 如`String${aa}`

正常来说，在词法分析中，除法运算符(/)和正则表达式(/abc/),是没有办法去处理的。所以Js的解决方案是**定义两组词法，然后靠语法分析传一个标志给词法分析器，让它来决定用那一套词法**。
## AST 抽象语法树
是源代码的抽象语法结构的树状变现形式，这里特指编程语言的源代码。树上的每个节点都表示源代码中的一种结构。
## Js语法分析
Js执行前会通过语法分析，构建AST语法树，在编译阶段将AST转换成可执行的代码。
### 分析阶段
若遇到语法错误，会抛出一个语法错误，停止js的执行，然后查找并加载下一个语法块儿，如果语法正确，则进入编译阶段。
### 编译阶段
1. **全局环境** js代码加载完毕后，进入到预编译也就是进入到全局环境
2. **函数环境** 函数调用的时候，进入到该函数环境，不同的函数，函数环境不同
编译阶段每进入到不同的运行环境，都会创建不同的执行上下文。一段Js程序一般会创建多个执行上下文，Js引擎会以栈的数据结构对其进行处理，形成**函数调用栈**。栈底永远是全局执行上下文，栈顶是当前执行上下文。
#### 创建执行上下文
1. 创建对象变量
检查当前上下文的函数声明，找到的函数提前声明，如果当前变量不存在该函数名属性，则在该变量对象以函数名建议一个属性。属性值将执行该函数所在堆地址引用，如果存在将会被新的引用覆盖。
上下文中没有变量声明，则已该变量声明一个值为undefined的属性。
2. 创建作用域链
作用域链由当前执行环境的变量对象（未进入到执行阶段前）与上层环境的一系列活动对象（执行后变为活动对象）组成，保证了当前执行环境对符合访问权限的变量和函数有序访问。
3. 确定this指向

### 执行阶段
Js是单线程的，为了实现非阻塞，采用异步机制
EventLoop 执行js的主线程，主js执行完成之后会去读取事件队列中的事件，推入执行栈，进行执行，如此往复

### 产生式
在计算机中指Tiger编译器将源程序经过词法分析（Lexical Analysis）和语法分析（Syntax Analysis）后得到的一系列符合文法规则（Backus-Naur Form，BNF）的语句
- 用尖括号（<, >）括起来的名称来表示语法结构名
- 语法结构分成基础结构和需要用其他语法结构定义的复合结构
  - 基础结构称终结符
  - 复合结构称非终结符
- 引号和中间的字符表示终结符
- 可以有括号
- *表示重复多次
- | 表示 “或”
- + 表示至少一次

